<!-- Webex Chat Widget -->
<div id="divicw"
     data-bind="3D1D9598-D443-44F2-92A0-CC28A2AE17D5"
     data-org=""
     data-guid="8b7360a8-b468-463c-840f-64b1472616e6">
</div>

<style>
  /* Responsive styles for chat widget */
  @media (max-width: 768px) {
    /* Force chat iframe or container to fill viewport on mobile */
    iframe#imi_chat_widget_iframe,
    .imi-chat-widget,
    .imi-widget-container {
      position: fixed !important;
      bottom: 0 !important;
      right: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      max-width: none !important;
      max-height: none !important;
      border-radius: 0 !important;
      z-index: 999999 !important;
    }

    /* Hide any duplicate floating buttons */
    .imi-float-button,
    .imi-launch-button {
      display: none !important;
    }
  }

  /* Prevent horizontal scroll on mobile */
  html, body {
    overflow-x: hidden;
  }
</style>

<!-- Load the chat widget -->
<script>
  var i = {
    t: function () {
      var scriptUrl = "https://media.imi.chat/widget/js/imichatinit.js";
      try {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (this.readyState === 4) {
            var div = document.getElementById("divicw");
            if (this.status === 0) {
              i.o(div);
              return;
            }
            var s = document.createElement("script");
            s.innerHTML = this.responseText;
            div.parentNode.insertBefore(s, div.nextSibling);
          }
        };
        xhr.open("GET", scriptUrl, true);
        xhr.send();
      } catch (err) {
        console.error(err);
      }
    },
    o: function (div) {
      console.warn("Chat not supported or script load failed.");
    }
  };
  i.t();

  // Optional: Auto open chat window on mobile portrait
  function isMobile() {
    return window.innerWidth <= 768;
  }

  function openChatOnMobile() {
    if (isMobile()) {
      const intervalId = setInterval(() => {
        if (window.IMI && IMI.chat && typeof IMI.chat.openChatWindow === "function") {
          clearInterval(intervalId);
          IMI.chat.openChatWindow();
        }
      }, 300);

      // Stop trying after 10 seconds
      setTimeout(() => clearInterval(intervalId), 10000);
    }
  }

  window.addEventListener("load", () => {
    setTimeout(openChatOnMobile, 2000);
  });
</script>

